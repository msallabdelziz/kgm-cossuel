{% extends 'base.html.twig' %}

{% block title %}Accueil
{% endblock %}
{% block body %}

	{% if app.user and app.user.isverified %}
		<!-- ========== title-wrapper start ========== -->
		<div class="title-wrapper pt-30">
			<div class="row">
				<div class="col-md-4">
					<div class="card bg-red p-4 card-stat">
						<div class="un-stat d-flex">
							<div class="icone">
								<img src="{{ asset('assets/img/demandes.svg') }}" alt="">
							</div>
							<div class="desc">
								<p class="mb-2">Total des demandes</p>
								<h5 class="number mb-0">{{ les_stat["All"] }}</h5>
							</div>
						</div>
					</div>
				</div>
				<!-- end col -->
				<div class="col-md-4">
					<div class="card bg-green p-4 card-stat">
						<div class="un-stat d-flex">
							<div class="icone">
								<img src="{{ asset('assets/img/demandes.svg') }}" alt="">
							</div>
							<div class="desc">
								<p class="mb-2">Demandes domestiques</p>
								<h5 class="number mb-0">{{ les_stat["Domestiques"] }}</h5>
							</div>
						</div>
					</div>
				</div>
				<!-- end col -->
				<div class="col-md-4">
					<div class="card bg-blue card-stat">
						<div class="un-stat d-flex">
							<div class="icone">
								<img src="{{ asset('assets/img/demandes.svg') }}" alt="">
							</div>
							<div class="desc">
								<p class="mb-2">Demandes non domestiques</p>
								<h5 class="number mb-0">{{ les_stat["Non Domestiques"] }}</h5>
							</div>
						</div>
					</div>
				</div>
				<div class="mt-4"></div>
				<!-- end col -->
				{% set les_etat = ["Soumis", "Paiement enregistré", "Paiement validé", "Demande validée", "Dossier créé", "Dossier affecté", "Dossier avec visite planifiée", "Dossier avec rapport établi", "Dossier cloturé"] %}
				{% set les_col = ["danger", "warning", "green", "info", "red", "light", "dark bg-opacity-50", "primary", "green"] %}
				{% set ix = 0 %}
				{% for etat in les_etat  %}
					{% set col = les_col[ix] %}
					<div class="col-md-4 mt-2">
						<div class="card bg-{{col}} p-3 card-stat">
							<div class="un-stat d-flex">
								<div class="">
									<p class="mb-1">
										<span class="fw-bold number mb-0 fs-7 badge badge-danger">{{ les_stat[etat] }}</span>
										<span>{{etat}}</span>
									</p>
									
								</div>
							</div>
						</div>
					</div>
					{% set ix = ix+1 %}
				{% endfor %}
			</div>
			<!-- end row -->

			<div class="row mt-50">
				<div class="col-md-8">
					<div class="card">
						<div class="d-flex align-items-center justify-content-between">
							<h4 class="fw-bold">Demandes en préparation ({{ les_install|length }})</h4>
						</div>
						<span class="divider">
							<hr></span>
            {% if les_install|length == 0 %}
                <div class="row pt-20">
                    <div class="col-3"></div>
                    <div class="col-6">
                        <div class="alert alert-warning d-flex align-items-center" role="alert">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 24 24">
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                                </svg>
                                Aucun enregistrement trouvé !
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
            <table class="table table-striped table-hover table-sm pt-0 mt-0">
            <thead>
                <tr>
                    <th scope="col">N° demande</th> 
                    <th scope="col">Usage</th> 
                    <th>Localité</th>
                    <th>Type Construction</th>
                    <th>Statut demande</th>
                    {# <th scope="col">Agence</th> #}
                    {# <th class="text-center" scope="col">Départements</th>  #}
                </tr>
            </thead>
            <tbody>
                {% for ag in les_install %}
                    {% if ag.step < 7 %}
                        {% set badge_etat = "danger" %}
                    {% endif %}
                    {% if ag.step <= 7 %}
                        {% set badge_etat = "warning" %}
                    {% endif %}
                    <tr>
                        <td scope="row" class="fw-bold">
                            {% if ag.demandeCourante %}
                                    {{ ag.demandeCourante.numero }}
                            {% else %}
                                    <span>[{{ ag.id|strpad_left(9, '0') }}-{{ ag.createdAt|date("d/m/y") }}]</span>
                            {% endif %}
                        </td>
                        <td>{{ ag.usages }}</td>
                        <td>
                            {% if ag.localite is not null %}
                                {{ ag.localite.nom }}
                            {% else %}
                                <span class="text-danger">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if ag.typeconstruction is not null %}
                                {{ ag.typeconstruction.nom }}
                            {% else %}
                                <span class="text-danger">-</span>
                            {% endif %}
                        </td>
                        <td>
								<span class="pt badge badge-info fs-8">{{ ag.etat }}</span>
                        </td>
                        {# <td>{{ ag.agence }}</td> #}
                        {# <td class="text-center">
                            {% if reg.departement.count >0 %}
                                <span class="badge bg-success text-red rounded-pill fw-normal">{{ reg.departement.count }}</span>
                            {% else %}
                                <code class="text-danger text-opacity-50">Aucun département</code>
                            {% endif %}
                        </td> #}
                    </tr>
                {% endfor %}
            </tbody>
            </table>
            {% endif %}
					</div>

				</div>
				<div class="col-md-4">
					<div class="card card-clients">
						<h4 class="fw-bold">Derniers clients enregistrés</h4>
						<span class="divider">
							<hr></span>
						<ul class="pl-0">
							{% for ag in last_client %}
							<li class="un-client d-flex align-items-center mt-3">
								<div class="flex-shrink-0">
									<img src="{{ asset('assets/img/avatar.jpg') }}" alt="...">
								</div>
								<div class="flex-grow-1 ms-2 d-flex flex-wrap align-items-center justify-content-between">
									<div class="me-2">
										<h5 class="mb-0">{{ ag.prenom }} {{ ag.nom }}</h5>
										<p class="mb-0">
										{% if ag.localite %}
											{{ ag.localite.nom }}
										{% else %}
											-
										{% endif %}
										, {{ ag.adresse }}, {{ ag.telephone }}
										</p>
									</div>
									<span class="badge badge-warning">Electricien</span>
								</div>
							</li>
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- ========== title-wrapper end ========== -->
	{% else %}
		<div class="col-8 mt-5 offset-2 alert alert-danger fs-4 text-center">
			Votre adresse email n'a pas encore été confirmée !
			Veuillez cliquer sur le lien envoyé sur votre boite mail pour valider votre inscription !
		</div>
	{% endif %}

{% endblock %}
